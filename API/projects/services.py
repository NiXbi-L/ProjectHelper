"""
Сервисы для работы с проектами
"""
from .models import Project, DevelopmentStage, StageHint


def create_default_stages(project):
    """Создание стандартных этапов проекта с подсказками"""
    
    stages_data = [
        {
            'name': '1. Постановка задачи и анализ требований',
            'stage_type': 'planning',
            'description': 'Определение целей проекта, анализ требований заказчика, формулировка технического задания',
            'order': 1,
            'hints': [
                {
                    'title': 'Что нужно сделать?',
                    'content': 'Проведите встречу с заказчиком, соберите все требования, документируйте их. Определите границы проекта и ограничения.',
                    'order': 1
                },
                {
                    'title': 'Результат этапа',
                    'content': 'Техническое задание, список требований, описание функциональности, ограничения проекта.',
                    'order': 2
                },
                {
                    'title': 'Вопросы для обсуждения',
                    'content': 'Что должен делать проект? Кто будет пользователем? Какие есть ограничения по времени и ресурсам?',
                    'order': 3
                }
            ]
        },
        {
            'name': '2. Анализ предметной области',
            'stage_type': 'analysis',
            'description': 'Изучение предметной области, анализ существующих решений, исследование технологий',
            'order': 2,
            'hints': [
                {
                    'title': 'Что изучить?',
                    'content': 'Изучите похожие проекты, проанализируйте конкурентов, определите лучшие практики в вашей области.',
                    'order': 1
                },
                {
                    'title': 'Технологический стек',
                    'content': 'Исследуйте подходящие технологии, фреймворки, библиотеки. Оцените их плюсы и минусы для вашего проекта.',
                    'order': 2
                },
                {
                    'title': 'Результат этапа',
                    'content': 'Аналитический отчет, выбор технологий, обоснование решений, список рисков.',
                    'order': 3
                }
            ]
        },
        {
            'name': '3. Проектирование архитектуры',
            'stage_type': 'design',
            'description': 'Проектирование архитектуры системы, создание диаграмм, описание структуры данных',
            'order': 3,
            'hints': [
                {
                    'title': 'Архитектура системы',
                    'content': 'Спроектируйте общую архитектуру: какие компоненты будут, как они взаимодействуют, какие модули нужны.',
                    'order': 1
                },
                {
                    'title': 'Диаграммы',
                    'content': 'Создайте диаграммы: Use Case, ER-диаграммы базы данных, диаграммы последовательности, архитектурные схемы.',
                    'order': 2
                },
                {
                    'title': 'API и интерфейсы',
                    'content': 'Опишите API endpoints, структуру данных, форматы обмена информацией между компонентами.',
                    'order': 3
                },
                {
                    'title': 'Результат этапа',
                    'content': 'Архитектурная документация, диаграммы, описание API, схема базы данных.',
                    'order': 4
                }
            ]
        },
        {
            'name': '4. Разработка',
            'stage_type': 'development',
            'description': 'Написание кода, реализация функциональности, создание интерфейсов',
            'order': 4,
            'hints': [
                {
                    'title': 'Планирование разработки',
                    'content': 'Разбейте разработку на задачи, распределите между участниками, установите дедлайны.',
                    'order': 1
                },
                {
                    'title': 'Версионирование',
                    'content': 'Используйте Git для контроля версий. Делайте коммиты регулярно, пишите понятные сообщения коммитов.',
                    'order': 2
                },
                {
                    'title': 'Code Review',
                    'content': 'Проводите код-ревью перед мерджем в основную ветку. Это поможет найти ошибки и улучшить качество кода.',
                    'order': 3
                },
                {
                    'title': 'Документация кода',
                    'content': 'Пишите комментарии к сложным местам, документируйте функции и классы. Это поможет команде понимать код.',
                    'order': 4
                }
            ]
        },
        {
            'name': '5. Тестирование',
            'stage_type': 'testing',
            'description': 'Написание тестов, проверка функциональности, поиск и исправление ошибок',
            'order': 5,
            'hints': [
                {
                    'title': 'Виды тестирования',
                    'content': 'Проведите unit-тесты (тесты отдельных функций), integration-тесты (тесты взаимодействия компонентов), тесты пользовательских сценариев.',
                    'order': 1
                },
                {
                    'title': 'Тест-кейсы',
                    'content': 'Составьте список тест-кейсов: что нужно проверить, как проверить, какой ожидается результат.',
                    'order': 2
                },
                {
                    'title': 'Отчет о тестировании',
                    'content': 'Зафиксируйте найденные баги, их критичность, шаги воспроизведения. Исправьте ошибки и перепроверьте.',
                    'order': 3
                }
            ]
        },
        {
            'name': '6. Документация и подготовка к защите',
            'stage_type': 'deployment',
            'description': 'Написание документации проекта, подготовка презентации, подготовка к защите',
            'order': 6,
            'hints': [
                {
                    'title': 'Документация проекта',
                    'content': 'Напишите README с инструкцией по установке и запуску, опишите архитектуру, API, примеры использования.',
                    'order': 1
                },
                {
                    'title': 'Презентация',
                    'content': 'Подготовьте презентацию: проблема и решение, архитектура, основные функции, демонстрация работы, результаты.',
                    'order': 2
                },
                {
                    'title': 'Демо',
                    'content': 'Подготовьте демо-версию проекта, которая покажет основные возможности. Убедитесь, что все работает стабильно.',
                    'order': 3
                },
                {
                    'title': 'Результат этапа',
                    'content': 'Полная документация проекта, презентация, готовый к демонстрации проект.',
                    'order': 4
                }
            ]
        },
        {
            'name': '7. Защита проекта',
            'stage_type': 'deployment',
            'description': 'Защита проекта перед комиссией, ответы на вопросы, получение обратной связи',
            'order': 7,
            'hints': [
                {
                    'title': 'Подготовка к защите',
                    'content': 'Отрепетируйте презентацию, подготовьте ответы на возможные вопросы, проверьте демо еще раз.',
                    'order': 1
                },
                {
                    'title': 'Во время защиты',
                    'content': 'Расскажите о проблеме, которую решает проект, покажите решение, продемонстрируйте работу, ответьте на вопросы.',
                    'order': 2
                },
                {
                    'title': 'Обратная связь',
                    'content': 'Запишите замечания комиссии, подумайте над улучшениями, поблагодарите за обратную связь.',
                    'order': 3
                }
            ]
        }
    ]
    
    for stage_data in stages_data:
        hints = stage_data.pop('hints', [])
        stage = DevelopmentStage.objects.create(
            project=project,
            **stage_data
        )
        
        for hint_data in hints:
            StageHint.objects.create(
                stage=stage,
                **hint_data
            )
    
    return project.stages.all()

